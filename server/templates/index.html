{% extends 'base.html' %} {% block title %}Biotools linter{% endblock %} {% block extrahead %}{% endblock %} {% block content %}
<p></p>
<article>
    <h1>Bio.tools linter</h1>
    <p>
        A rule-based checker for the <a href="https://bio.tools/">bio.tools database</a>. The linter searches the entire
        bio.tools API and checks various properties of the tool's JSON data, such as dead URL links, and sends it to
        a database this website draws from.
        Currently serving <code>{{error_count}}</code> errors for <code>{{tool_count}}</code> tools.
        Oldest entry was linted at <code>{{last_time | date(format="%Y-%m-%d %H:%M") }}</code>.
    </p>

    <div id="table"></div>
</article>

<script>
    new gridjs.Grid({
        columns: [{
            name: "Tool name",
            attributes: (cell) => {
                // add break-all to the name column
                if (cell) {
                    return {
                        'style': 'word-break: break-all',
                    }
                }
            }
        },
        "Code",
        "Error",
        { 
            name: 'Severity',
            formatter: (cell) => {switch (cell) {
                case 4:
                    return "Critical"
                    break;
                case 5:
                    return "High"
                    break;
                case 6:
                    return "Medium"
                    break;
                case 7:
                    return "Low"
                    break;
                default:
                    return "Error";
            }}
        },
        "Found at",
        "Links"
        ],
        search: {
            server: {
                url: (prev, keyword) => `${prev}?query=${keyword}`
            },
            debounceTimeout: 750,

        },
        pagination: {
            limit: 100,
            server: {
                url: (prev, page, limit) => `${prev}${prev.includes('?') ? '&' : '?'}page=${page}`
            }
        },
        server: {
            url: '/api/search',
            then: data => data.results.map(entry => [
                gridjs.html(`<a target="_blank" href="https://bio.tools/${entry.tool}">${entry.tool}</a>`),
                entry.code,
                gridjs.html(entry.text),
                entry.severity,
                entry.timestamp,
                gridjs.html(`<a target="_blank" href="https://bio.tools/api/tool/${entry.tool}">JSON</a>
                <a target="_blank" href="https://bio.tools/${entry.tool}/edit">Edit</a>`)
            ]),
            total: data => data.count
        },
        language: {
            'search': {
                'placeholder': 'üîç Search for name, biotools ID or error code'
            },
        },
        resizable: true,
        width: "100%",
        style: {
            table: {
                'white-space': 'pre-line',
            }
        },
    }).render(document.getElementById("table"));

</script>
{% endblock %}